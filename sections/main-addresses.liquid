{% schema %}
{
  "name": "Main Addresses",
  "settings": []
}
{% endschema %}

<!-- Main Content -->
<div class="main-content-account">
    <!-- Breadcrumb -->
    <div class="tf-breadcrumb">
        <div class="container">
            <ul class="breadcrumb-list">
                <li class="item-breadcrumb">
                    <a href="{{ routes.root_url }}" class="text">Home</a>
                </li>
                <li class="item-breadcrumb dot">
                    <span></span>
                </li>
                <li class="item-breadcrumb">
                    <span class="text">Account</span>
                </li>
            </ul>
        </div>
    </div>
    <!-- /Breadcrumb -->

    <!-- Title Page -->
    <section class="s-title-page">
        <div class="container">
            <h4 class="s-title letter-0 text-center">
                My Account
            </h4>
        </div>
    </section>
    <!-- /Title Page -->

    <!-- sidebar-account -->
    <div class="btn-sidebar-mb d-lg-none">
        <button data-bs-toggle="offcanvas" data-bs-target="#mbAccount">
            <i class="icon icon-sidebar"></i>
        </button>
    </div>
    <!-- /sidebar-account -->

    <!-- Account -->
    <section class="s-account flat-spacing-25">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="my-account-container">
                        <div class="sidebar-account-wrap sidebar-content-wrap sticky-top d-lg-block d-none">
                            <ul class="my-account-nav">
                                <li>
                                    <a href="{{ routes.account_url }}" class="text-sm link fw-medium my-account-nav-item {% if template == 'customers/account' %}active{% endif %}">
                                        Dashboard
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ routes.account_url }}/orders" class="text-sm link fw-medium my-account-nav-item {% if template == 'customers/orders' %}active{% endif %}">
                                        My Orders
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ routes.account_url }}/wishlist" class="text-sm link fw-medium my-account-nav-item {% if template == 'customers/wishlist' %}active{% endif %}">
                                        My Wishlist
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ routes.account_addresses_url }}" class="text-sm link fw-medium my-account-nav-item {% if template == 'customers/addresses' %}active{% endif %}">
                                        Addresses
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ routes.account_logout_url }}" class="text-sm link fw-medium my-account-nav-item">
                                        Log Out
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="my-acount-content account-address">
                            <h6 class="title-account">
                                Your addresses ({{ customer.addresses_count }})
                            </h6>
                            <div class="widget-inner-address">
                                <button class="tf-btn btn-add-address animate-btn" data-form="form-add-address">
                                    Add new address
                                </button>

                                {% form 'customer_address', customer.new_address %}
                                <div class="wd-form-address form-default show-form-address" id="form-add-address" style="display: none;">
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressFirstNameNew">First Name</label>
                                            <input type="text" id="AddressFirstNameNew" name="address[first_name]" value="{{ form.first_name }}" required>
                                        </fieldset>
                                        <fieldset>
                                            <label for="AddressLastNameNew">Last Name</label>
                                            <input type="text" id="AddressLastNameNew" name="address[last_name]" value="{{ form.last_name }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressCompanyNew">Company</label>
                                            <input type="text" id="AddressCompanyNew" name="address[company]" value="{{ form.company }}">
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="Address1New">Address 1</label>
                                            <input type="text" id="Address1New" name="address[address1]" value="{{ form.address1 }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressCityNew">City</label>
                                            <input type="text" id="AddressCityNew" name="address[city]" value="{{ form.city }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressCountryNew">Country/region</label>
                                            <select id="AddressCountryNew" name="address[country]" data-default="{{ form.country }}" required>
                                                {{ country_option_tags }}
                                            </select>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressProvinceNew">Province</label>
                                            <select id="AddressProvinceNew" name="address[province]" data-default="{{ form.province }}" required></select>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressZipNew">Postal/ZIP code</label>
                                            <input type="text" id="AddressZipNew" name="address[zip]" value="{{ form.zip }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressPhoneNew">Phone</label>
                                            <input type="tel" id="AddressPhoneNew" name="address[phone]" value="{{ form.phone }}">
                                        </fieldset>
                                    </div>
                                    <div class="tf-cart-checkbox">
                                        <input type="checkbox" name="address[default]" class="tf-check" id="default-address-add">
                                        <label for="default-address-add" class="label">
                                            <span>Set as default address</span>
                                        </label>
                                    </div>
                                    <div class="box-btn">
                                        <button class="tf-btn animate-btn" type="submit">
                                            Add
                                        </button>
                                        <a href="javascript:void(0);" class="tf-btn btn-out-line-dark btn-hide-address">
                                            Cancel
                                        </a>
                                    </div>
                                </div>
                                {% endform %}

                                <ul class="list-account-address tf-grid-layout md-col-2">
                                    {% for address in customer.addresses %}
                                    <li class="account-address-item">
                                        <p class="title text-md fw-medium">
                                            {{ address.address1 }}
                                        </p>
                                        <div class="info-detail">
                                            <div class="box-infor">
                                                <p class="text-md">{{ address.first_name }} {{ address.last_name }}</p>
                                                <p class="text-md">{{ customer.email }}</p>
                                                <p class="text-md">{{ address.company }}</p>
                                                <p class="text-md">{{ address.address1 }}</p>
                                                <p class="text-md">{{ address.city }}</p>
                                                <p class="text-md">{{ address.country }}</p>
                                                <p class="text-md">{{ address.zip }}</p>
                                                <p class="text-md">{{ address.phone }}</p>
                                            </div>
                                            <div class="box-btn">
                                                <button class="tf-btn btn-out-line-dark btn-edit-address" data-form="form-edit-{{ address.id }}">
                                                    Edit
                                                </button>
                                                <button class="tf-btn btn-out-line-dark btn-delete-address" data-form="form-edit-{{ address.id }}">
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </ul>

                                {% for address in customer.addresses %}
                                {% form 'customer_address', address %}
                                <div class="wd-form-address form-default edit-form-address" id="form-edit-{{ address.id }}">
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressFirstName_{{ address.id }}">First Name</label>
                                            <input type="text" id="AddressFirstName_{{ address.id }}" name="address[first_name]" value="{{ form.first_name }}" required>
                                        </fieldset>
                                        <fieldset>
                                            <label for="AddressLastName_{{ address.id }}">Last Name</label>
                                            <input type="text" id="AddressLastName_{{ address.id }}" name="address[last_name]" value="{{ form.last_name }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressCompany_{{ address.id }}">Company</label>
                                            <input type="text" id="AddressCompany_{{ address.id }}" name="address[company]" value="{{ form.company }}">
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="Address1_{{ address.id }}">Address 1</label>
                                            <input type="text" id="Address1_{{ address.id }}" name="address[address1]" value="{{ form.address1 }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressCity_{{ address.id }}">City</label>
                                            <input type="text" id="AddressCity_{{ address.id }}" name="address[city]" value="{{ form.city }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressCountry_{{ address.id }}">Country/region</label>
                                            <select id="AddressCountry_{{ address.id }}" name="address[country]" data-default="{{ form.country }}" required>
                                                {{ country_option_tags }}
                                            </select>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressProvince_{{ address.id }}">Province</label>
                                            <select id="AddressProvince_{{ address.id }}" name="address[province]" data-default="{{ form.province }}" required></select>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressZip_{{ address.id }}">Postal/ZIP code</label>
                                            <input type="text" id="AddressZip_{{ address.id }}" name="address[zip]" value="{{ form.zip }}" required>
                                        </fieldset>
                                    </div>
                                    <div class="cols">
                                        <fieldset>
                                            <label for="AddressPhone_{{ address.id }}">Phone</label>
                                            <input type="tel" id="AddressPhone_{{ address.id }}" name="address[phone]" value="{{ form.phone }}">
                                        </fieldset>
                                    </div>
                                    <div class="tf-cart-checkbox">
                                        <input type="checkbox" name="address[default]" class="tf-check" id="default-address-edit-{{ address.id }}" {% if address.default %}checked{% endif %}>
                                        <label for="default-address-edit-{{ address.id }}" class="label">
                                            <span>Set as default address</span>
                                        </label>
                                    </div>
                                    <div class="box-btn">
                                        <button class="tf-btn animate-btn" type="submit">
                                            Update
                                        </button>
                                        <a href="javascript:void(0);" class="tf-btn btn-out-line-dark btn-hide-edit-address">
                                            Cancel
                                        </a>
                                    </div>
                                </div>
                                {% endform %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- /Account -->
</div>
<!-- /Main Content -->

{% javascript %}
  // Initialize province/state selectors
  document.addEventListener('DOMContentLoaded', function() {
    const countrySelectors = document.querySelectorAll('select[data-default]');
    countrySelectors.forEach(function(selector) {
      new Shopify.CountryProvinceSelector(selector.id, selector.id.replace('Country', 'Province'), {
        hideElement: selector.id.includes('New') ? 'AddressProvinceNew' : 'AddressProvince_' + selector.id.split('_')[1]
      });
    });

    // Handle add new address form
    const addAddressBtn = document.querySelector('.btn-add-address');
    const addAddressForm = document.getElementById('form-add-address');
    const hideAddressBtn = document.querySelector('.btn-hide-address');

    if (addAddressBtn && addAddressForm) {
      addAddressBtn.addEventListener('click', function(e) {
        e.preventDefault();
        addAddressForm.style.display = 'block';
      });
    }

    if (hideAddressBtn && addAddressForm) {
      hideAddressBtn.addEventListener('click', function(e) {
        e.preventDefault();
        addAddressForm.style.display = 'none';
      });
    }

    // Handle edit address forms
    const editAddressBtns = document.querySelectorAll('.btn-edit-address');
    const hideEditAddressBtns = document.querySelectorAll('.btn-hide-edit-address');
    const deleteAddressBtns = document.querySelectorAll('.btn-delete-address');

    editAddressBtns.forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const formId = this.getAttribute('data-form');
        const form = document.getElementById(formId);
        if (form) {
          form.style.display = 'block';
        }
      });
    });

    hideEditAddressBtns.forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const form = this.closest('.edit-form-address');
        if (form) {
          form.style.display = 'none';
        }
      });
    });

    deleteAddressBtns.forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const formId = this.getAttribute('data-form');
        const form = document.getElementById(formId);
        if (form && confirm('Are you sure you want to delete this address?')) {
          const deleteForm = document.createElement('form');
          deleteForm.method = 'post';
          deleteForm.action = form.action + '/delete';
          document.body.appendChild(deleteForm);
          deleteForm.submit();
        }
      });
    });
  });
{% endjavascript %}
