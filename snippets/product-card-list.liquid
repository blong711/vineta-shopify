{% comment %}
    Product Card List View
    Accepts:
    - product: The product object
    - show_progress_sale: Boolean to show/hide progress sale (default: true)
    - card_image_ratio: Image aspect ratio (adapt, portrait, landscape, square)
{% endcomment %}

{% comment %} Handle show_progress_sale parameter {% endcomment %}
{% assign card_image_ratio = card_image_ratio | default: settings.card_image_ratio | default: 'adapt' %}

<div class="card-product style-list" 
     data-availability="{{ product.available | default: false }}"
     data-brand="{{ product.vendor | handleize }}"
     data-price="{{ product.price | divided_by: 100.0 | round: 2 }}"
     {% if product.compare_at_price > product.price %}data-sale="true"{% endif %}>
    <div class="card-product-wrapper asp-ratio-{{ card_image_ratio }}">
        <a href="{{ product.url }}" class="product-img">
            {% if product.featured_image %}
                <img class="img-product lazyload" 
                    data-src="{{ product.featured_image | image_url: width: 460, height: 460, crop: 'center' }}"
                    src="{{ product.featured_image | image_url: width: 460, height: 460, crop: 'center' }}" 
                    alt="{{ product.featured_image.alt | escape }}" width="460" height="460"
                    loading="lazy">
                <img class="img-hover lazyload" 
                    data-src="{{ product.images[1] | default: product.featured_image | image_url: width: 460, height: 460, crop: 'center' }}"
                    src="{{ product.images[1] | default: product.featured_image | image_url: width: 460, height: 460, crop: 'center' }}"
                    alt="{{ product.images[1].alt | default: product.featured_image.alt | escape }}" width="460" height="460"
                    loading="lazy">
            {% endif %}
        </a>
    </div>
    <div class="card-product-info">
        <div class="info-list">
            <a href="{{ product.url }}" class="name-product link fw-medium text-md">{{ product.title }}</a>
            <p class="price-wrap fw-medium text-md">
                <span class="price-new text-primary">
                    {%- if settings.currency_code_enabled -%}
                        {{- product.price | money }}
                        {{ shop.currency -}}
                    {%- else -%}
                        {{- product.price | money -}}
                    {%- endif -%}
                </span>
                {% if product.compare_at_price > product.price %}
                    <span class="price-old">
                        {%- if settings.currency_code_enabled -%}
                            {{- product.compare_at_price | money }}
                            {{ shop.currency -}}
                        {%- else -%}
                            {{- product.compare_at_price | money -}}
                        {%- endif -%}
                    </span>
                {% endif %}
            </p>
            <p class="decs text-sm text-main text-line-clamp-2">
                {{ product.description | strip_html | truncate: 200 }}
            </p>
            
            {% comment %} Color Swatches {% endcomment %}
            {% if product.options_with_values.size > 0 %}
                {% for option in product.options_with_values %}
                    {% if option.name == 'Color' or option.name == 'Colour' %}
                        <ul class="list-color-product">
                            {% for value in option.values %}
                                {% assign variant_for_value = null %}
                                {% for variant in product.variants %}
                                    {% if variant.option1 == value or variant.option2 == value or variant.option3 == value %}
                                        {% assign variant_for_value = variant %}
                                        {% break %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if variant_for_value and variant_for_value.featured_image %}
                                    <li class="list-color-item color-swatch hover-tooltip tooltip-bot{% if forloop.first %} active{% endif %}">
                                        <span class="d-none color-filter">{{ value }}</span>
                                        <span class="swatch-value bg-{{ value | handle }}"></span>
                                        <img class="lazyload" 
                                            data-src="{{ variant_for_value.featured_image | image_url: width: 460, height: 460, crop: 'center' }}"
                                            src="{{ variant_for_value.featured_image | image_url: width: 460, height: 460, crop: 'center' }}" 
                                            alt="{{ variant_for_value.featured_image.alt | escape }}" width="50" height="50"
                                            loading="lazy">
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endfor %}
            {% endif %}
            
            {% comment %} Size Options {% endcomment %}
            {% if product.options_with_values.size > 0 %}
                {% for option in product.options_with_values %}
                    {% if option.name == 'Size' %}
                        <ul class="size-box">
                            {% for value in option.values %}
                                <li class="size-item text-xs">{{ value }}</li>
                            {% endfor %}
                        </ul>
                        {% break %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
        
        <div class="list-product-btn">
            <a data-bs-toggle="offcanvas" class="tf-btn btn-main-product animate-btn product-cart-button" data-product-id="{{ product.id }}" data-product-handle="{{ product.handle }}" data-variant-id="{{ product.selected_or_first_available_variant.id }}">{{ 'snippets.product-card.add_to_cart' | t }}</a>
            <div class="wishlist">            
                <a class="box-icon hover-tooltip" data-product-id="{{ product.id }}"
                    data-product-handle="{{ product.handle }}">
                    <span class="icon icon-heart2"></span>
                    <span class="tooltip">{{ 'snippets.product-card.add_to_wishlist' | t }}</span>
                </a>
            </div>
            <div class="quickview">
                <div 
                    class="hover-tooltip box-icon quickview btn-quickview{% if card_style == 'style-1' or card_style == 'style-small' %} tooltip-left{% endif %}" 
                    data-product-id="{{ product.id }}"
                    data-product-handle="{{ product.handle }}"
                    data-product-title="{{ product.title | escape }}"
                    data-product-price="{{ product.price | money }}"
                    data-product-compare-price="{{ product.compare_at_price | money }}"
                    data-product-description="{{ product.description | strip_html | truncate: 150 | escape }}"
                    data-product-url="{{ product.url }}"
                    data-product-images="{% for image in product.images %}{{ image | image_url: width: 600 }}{% unless forloop.last %},{% endunless %}{% endfor %}"
                    data-product-variants="{{ product.variants | json | escape }}"
                    data-product-options="{{ product.options_with_values | json | escape }}"
                    aria-label="Quick view of {{ product.title }}">
                            <span class="icon icon-view"></span>
                            <span class="tooltip">{{ 'snippets.product-card.quick_view' | t }}</span>
                </div>
            </div>
            <div class="compare">
                <a class="box-icon hover-tooltip" data-product-id="{{ product.id }}"
                    data-product-handle="{{ product.handle }}">
                    <span class="icon icon-compare3"></span>
                    <span class="tooltip">{{ 'snippets.product-card.add_to_compare' | t }}</span>
                </a>
            </div>
        </div>
        
        {% comment %} Hidden size and color options for filtering {% endcomment %}
        <div style="display: none;" class="product-options">
            {% for option in product.options_with_values %}
                {% if option.name == 'Size' %}
                    {% for value in option.values %}
                        <span class="size-item" data-size="{{ value }}">{{ value }}</span>
                    {% endfor %}
                {% elsif option.name == 'Color' %}
                    {% for value in option.values %}
                        <span class="color-swatch" data-color="{{ value }}">{{ value }}</span>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        </div>
        
        {% comment %} Sale indicator for filtering {% endcomment %}
        {% if product.compare_at_price > product.price %}
            <div style="display: none;" class="on-sale-wrap"></div>
        {% endif %}
    </div>
</div>